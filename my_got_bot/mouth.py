"""
Ð§Ð¢Ðž Ð”Ð•Ð›ÐÐ•Ð¢ Ð­Ð¢ÐžÐ¢ Ð¤ÐÐ™Ð› / ÐœÐžÐ”Ð£Ð›Ð¬:
ÐžÑ‚Ð²ÐµÑ‡Ð°ÐµÑ‚ Ð·Ð° Ñ„Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð²Ñ‹Ð²Ð¾Ð´ Ð¾Ñ‚Ð²ÐµÑ‚Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ. ÐÐ½Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐµÑ‚ Ð¾Ñ‚Ð²ÐµÑ‚ Ð¼Ð¾Ð´ÐµÐ»Ð¸,
Ð¸Ñ‰ÐµÑ‚ Ð¼Ð°Ñ€ÐºÐµÑ€ FINAL_ANSWER: Ð¸ Ð¸Ð·Ð²Ð»ÐµÐºÐ°ÐµÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐºÐ¾Ð½ÐµÑ‡Ð½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚, Ð¾Ñ‚ÑÐµÐºÐ°Ñ Ð²ÑÑŽ
Ð¿Ñ€Ð¾Ð¼ÐµÐ¶ÑƒÑ‚Ð¾Ñ‡Ð½ÑƒÑŽ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÑƒ Ñ€Ð°ÑÑÑƒÐ¶Ð´ÐµÐ½Ð¸Ð¹. Ð•ÑÐ»Ð¸ Ñ„Ð¸Ð½Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾Ñ‚Ð²ÐµÑ‚Ð° Ð½ÐµÑ‚ â€” Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚
Ð²ÑÑŽ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÑƒ Ñ†ÐµÐ»Ð¸ÐºÐ¾Ð¼. ÐšÑ€Ð°ÑÐ¸Ð²Ð¾ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€ÑƒÐµÑ‚ Ð²Ñ‹Ð²Ð¾Ð´ Ð² ÐºÐ¾Ð½ÑÐ¾Ð»ÑŒ.
"""


def extract_final_answer(response_text):
    """
    Ð˜Ð·Ð²Ð»ÐµÐºÐ°ÐµÑ‚ Ñ„Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚ Ð¸Ð· Ð¾Ñ‚Ð²ÐµÑ‚Ð° Ð¼Ð¾Ð´ÐµÐ»Ð¸.
    Ð˜Ñ‰ÐµÑ‚ ÑÑ‚Ñ€Ð¾ÐºÑƒ "FINAL_ANSWER:" Ð¸ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð²ÑÑ‘, Ñ‡Ñ‚Ð¾ Ð¿Ð¾ÑÐ»Ðµ Ð½ÐµÑ‘.
    """
    if "FINAL_ANSWER:" in response_text:
        # ÐÐ°Ñ…Ð¾Ð´Ð¸Ð¼ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸ÑŽ Ð¼Ð°Ñ€ÐºÐµÑ€Ð°
        marker = "FINAL_ANSWER:"
        idx = response_text.find(marker)
        # Ð˜Ð·Ð²Ð»ÐµÐºÐ°ÐµÐ¼ Ð²ÑÑ‘ Ð¿Ð¾ÑÐ»Ðµ Ð¼Ð°Ñ€ÐºÐµÑ€Ð° Ð¸ ÑƒÐ±Ð¸Ñ€Ð°ÐµÐ¼ Ð»Ð¸ÑˆÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð±ÐµÐ»Ñ‹
        final_answer = response_text[idx + len(marker):].strip()
        return final_answer, True  # True = Ð½Ð°ÑˆÐ»Ð¸ Ñ„Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚
    
    # Ð•ÑÐ»Ð¸ Ð¼Ð°Ñ€ÐºÐµÑ€Ð° Ð½ÐµÑ‚ â€” Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ Ð²ÐµÑÑŒ Ñ‚ÐµÐºÑÑ‚ (Ð¿Ñ€Ð¾Ð¼ÐµÐ¶ÑƒÑ‚Ð¾Ñ‡Ð½Ð¾Ðµ Ñ€Ð°ÑÑÑƒÐ¶Ð´ÐµÐ½Ð¸Ðµ)
    return response_text, False


def speak(response_text):
    """
    Ð’Ñ‹Ð²Ð¾Ð´Ð¸Ñ‚ Ñ„Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ Ð² ÐºÑ€Ð°ÑÐ¸Ð²Ð¾Ð¼ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ.
    Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ ÐºÐ¾Ñ€Ñ‚ÐµÐ¶ (Ð¾Ñ‚Ð²ÐµÑ‚_Ð´Ð»Ñ_Ð¿Ð°Ð¼ÑÑ‚Ð¸, ÐµÑÑ‚ÑŒ_Ð»Ð¸_Ñ„Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹_Ð¾Ñ‚Ð²ÐµÑ‚).
    """
    print("\n" + "=" * 60)
    print("=== MOUTH ===")
    print("=" * 60)
    
    final_answer, is_final = extract_final_answer(response_text)
    
    if is_final:
        print("ðŸ—£ï¸  Ð¤Ð˜ÐÐÐ›Ð¬ÐÐ«Ð™ ÐžÐ¢Ð’Ð•Ð¢:")
        print(f"\n{final_answer}\n")
        return final_answer, True
    else:
        print("ðŸ’­ Ð•Ñ‰Ñ‘ Ð´ÑƒÐ¼Ð°ÑŽ...")
        print(f"\n{response_text[:200]}{'...' if len(response_text) > 200 else ''}\n")
        return response_text, False
